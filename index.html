<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Auction</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>English Auction</h1>
    <div id="auction-info">
        <p>Start: <span id="start"></span></p>
        <p>End: <span id="end"></span></p>
        <p>Current Highest Bid: <span id="currentHighestBid"></span> ETH</p>
        <p>Current Highest Bidder: <span id="currentHighestBidder"></span></p>
    </div>
    <form id="bid-form">
        <label for="bidAmount">Bid Amount (ETH):</label>
        <input type="number" id="bidAmount" min="0" step="0.01" required>
        <button type="submit">Place Bid</button>
    </form>
    <button id="withdrawBtn">Withdraw Funds</button>
    <button id="endAuctionBtn">End Auction</button>
    <button id="finalizeBtn">Finalize Auction</button>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
    <script src="app.js"></script>
    <div class="gallery-container">
        <div class="gallery-item">
          <img src="image1.jpg" alt="Image 1" class="gallery-image">
          <div class="bid-container">
            <input type="number" id="bidAmount1" min="0" step="0.01" required>
            <button type="button" onclick="placeBid(1)">Place Bid</button>
          </div>
        </div>
        <!-- Repeat for the other 3 items, changing the image source, id, and onclick argument accordingly -->
      </div>
      
</body>
</html>
.gallery-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 20px;
}

.gallery-item {
  width: 200px;
}

.gallery-image {
  width: 100%;
  height: auto;
}

.bid-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

// Replace with your contract's ABI and address
const contractABI = [
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_royaltyPercentage",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_start",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_end",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "_nftAddress",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_tokenId",
				"type": "uint256"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "winner",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "AuctionEnded",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "winner",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "AuctionFinalized",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "NFTTransferred",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "bidder",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "NewHighestBid",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "creator",
		"outputs": [
			{
				"internalType": "address payable",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "currentHighestBid",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "currentHighestBidder",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "end",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "endAuction",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "ended",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "escrow",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "finalize",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "nft",
		"outputs": [
			{
				"internalType": "contract IERC721",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "bytes",
				"name": "",
				"type": "bytes"
			}
		],
		"name": "onERC721Received",
		"outputs": [
			{
				"internalType": "bytes4",
				"name": "",
				"type": "bytes4"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address payable",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "placeBid",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "royaltyPercentage",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "start",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "tokenId",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "withdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
];
const contractAddress = "0x4668327D316BD75a9a402bf096DAAD8efF8Ef63d";

let web3, contract, accounts;

async function init() {
    if (typeof window.ethereum !== 'undefined') {
        web3 = new Web3(window.ethereum);
        await window.ethereum.enable();
    } else {
        alert('Please install MetaMask!');
        return;
    }

    contract = new web3.eth.Contract(contractABI, contractAddress);
    accounts = await web3.eth.getAccounts();
    updateUI();
}

async function updateUI() {
    const startTimestamp = await contract.methods.start().call();
    const endTimestamp = await contract.methods.end().call();
    const currentHighestBid = await contract.methods.currentHighestBid().call();
    const currentHighestBidder = await contract.methods.currentHighestBidder().call();

    document.getElementById('start').textContent = new Date(startTimestamp * 1000).toLocaleString();
    document.getElementById('end').textContent = new Date(endTimestamp * 1000).toLocaleString();
    document.getElementById('currentHighestBid').textContent = web3.utils.fromWei(currentHighestBid, 'ether');
    document.getElementById('currentHighestBidder').textContent = currentHighestBidder;
}

async function placeBid(itemIndex) {
    const bidAmount = parseFloat(document.getElementById(`bidAmount${itemIndex}`).value);
    if (isNaN(bidAmount) || bidAmount <= 0) {
      alert('Please enter a valid bid amount.');
      return;
    }
    const weiAmount = web3.utils.toWei(bidAmount.toString(), 'ether');
    await contract.methods.placeBid().send({ from: accounts[0], value: weiAmount });
    updateUI();
  }

async function withdrawFunds() {
    await contract.methods.withdraw().send({ from: accounts[0] });
    updateUI();
}

async function endAuction() {
    await contract.methods.endAuction().send({ from: accounts[0] });
    updateUI();
}

async function finalizeAuction() {
    await contract.methods.finalize().send({ from: accounts[0] });
    updateUI();
}

// Event listeners
document.getElementById('bid-form').removeEventListener('submit', placeBid);
document.getElementById('withdrawBtn').addEventListener('click', withdrawFunds);
document.getElementById('endAuctionBtn').addEventListener('click', endAuction);
document.getElementById('finalizeBtn').addEventListener('click', finalizeAuction);

// Initialize web3 and update UI
init();
